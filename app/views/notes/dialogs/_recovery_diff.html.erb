<!-- Offline Recovery Diff Dialog -->
<div data-controller="offline-backup recovery-diff"
     data-action="recovery-diff:resolved->app#onRecoveryResolved">
  <dialog
    data-recovery-diff-target="dialog"
    class="w-[90vw] max-w-6xl max-h-[80vh] p-0 rounded-lg shadow-xl bg-[var(--theme-bg-primary)] text-[var(--theme-text-primary)] backdrop:bg-black/50 border border-[var(--theme-border)]"
  >
    <div class="flex flex-col h-full">
      <!-- Header -->
      <div class="flex items-center justify-between px-6 py-4 border-b border-[var(--theme-border)]">
        <div class="flex items-center gap-3">
          <h2 class="text-lg font-semibold"><%= t('dialogs.recovery.title') %></h2>
          <span data-recovery-diff-target="backupTimestamp" class="text-xs px-2 py-1 rounded bg-[var(--theme-bg-tertiary)] text-[var(--theme-text-muted)]"></span>
        </div>
        <%= render "shared/dialog_close_button", action: "click->recovery-diff#acceptServer", size: "h-5 w-5", padding: "p-2", hover_bg: "hover:bg-[var(--theme-bg-secondary)]" %>
      </div>

      <!-- Diff Content -->
      <div class="flex-1 flex overflow-hidden">
        <!-- Server Version (Left) -->
        <div class="w-1/2 flex flex-col border-r border-[var(--theme-border)]">
          <div class="px-4 py-2 bg-[var(--theme-bg-secondary)] text-sm font-medium border-b border-[var(--theme-border)] text-[var(--theme-text-muted)]">
            <%= t('dialogs.recovery.server_version') %> <span class="text-xs opacity-70"><%= t('dialogs.recovery.server_hint') %></span>
          </div>
          <div class="flex-1 overflow-auto p-4">
            <div data-recovery-diff-target="serverText" class="whitespace-pre-wrap font-mono text-sm leading-relaxed ai-diff-content"></div>
          </div>
        </div>

        <!-- Backup Version (Right) -->
        <div class="w-1/2 flex flex-col">
          <div class="px-4 py-2 bg-[var(--theme-bg-secondary)] text-sm font-medium border-b border-[var(--theme-border)] text-[var(--theme-text-muted)]">
            <%= t('dialogs.recovery.backup_version') %> <span class="text-xs opacity-70"><%= t('dialogs.recovery.backup_hint') %></span>
          </div>
          <div class="flex-1 overflow-auto p-4">
            <div data-recovery-diff-target="backupText" class="whitespace-pre-wrap font-mono text-sm leading-relaxed ai-diff-content"></div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="flex items-center justify-end gap-3 px-6 py-4 border-t border-[var(--theme-border)]">
        <button type="button" data-action="click->recovery-diff#acceptServer" class="px-4 py-2 rounded-md border border-[var(--theme-border)] hover:bg-[var(--theme-bg-secondary)] text-[var(--theme-text-secondary)]">
          <%= t('dialogs.recovery.use_server') %>
        </button>
        <button type="button" data-action="click->recovery-diff#acceptBackup" class="px-4 py-2 rounded-md bg-[var(--theme-accent)] text-[var(--theme-accent-text)] hover:bg-[var(--theme-accent-hover)]">
          <%= t('dialogs.recovery.restore_backup') %>
        </button>
      </div>
    </div>
  </dialog>
</div>
