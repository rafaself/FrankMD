<div class="h-screen w-full flex flex-col bg-[var(--theme-bg-primary)] text-[var(--theme-text-primary)]" data-controller="app" data-app-tree-value="<%= @tree.to_json %>">
  <!-- Header -->
  <header class="flex-none h-12 border-b border-[var(--theme-border)] flex items-center justify-between px-4 bg-[var(--theme-bg-secondary)]">
    <div class="flex items-center gap-2">
      <!-- Sidebar Toggle (Burger Menu) -->
      <button
        type="button"
        data-action="click->app#toggleSidebar"
        data-app-target="sidebarToggle"
        class="p-1.5 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
        title="Toggle Explorer (Ctrl+E)"
        aria-expanded="true"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
      <svg class="w-5 h-5 text-[var(--theme-accent)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <span class="font-semibold text-sm">WebNotes</span>
    </div>
    <div class="flex items-center gap-2">
      <button
        type="button"
        data-action="click->app#toggleTypewriterMode"
        data-typewriter-mode-btn
        class="p-1.5 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
        title="Toggle Typewriter Mode (Ctrl+B)"
        aria-pressed="false"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
        </svg>
      </button>
      <button
        type="button"
        data-action="click->app#togglePreview"
        data-app-target="previewToggle"
        class="p-1.5 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
        title="Toggle Preview (Ctrl+Shift+P)"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg>
      </button>
      <!-- Theme Picker -->
      <div class="relative" data-controller="theme">
        <button
          type="button"
          data-action="click->theme#toggle"
          class="flex items-center gap-1.5 px-2 py-1.5 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
          title="Change Theme"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
          </svg>
          <span class="text-xs" data-theme-target="currentTheme">Light</span>
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <!-- Theme dropdown menu -->
        <div
          class="hidden absolute right-0 mt-1 w-48 rounded-lg shadow-lg bg-[var(--theme-bg-secondary)] border border-[var(--theme-border)] py-1 z-50"
          data-theme-target="menu"
        >
          <!-- Menu items rendered by JavaScript -->
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="flex-1 flex overflow-hidden">
    <!-- Sidebar -->
    <aside class="flex-none w-64 border-r border-[var(--theme-border)] flex flex-col bg-[var(--theme-bg-secondary)]" data-app-target="sidebar">
      <!-- Sidebar Header -->
      <div class="flex-none h-10 border-b border-[var(--theme-border)] flex items-center justify-between px-3">
        <span class="text-xs font-medium text-[var(--theme-text-muted)] uppercase tracking-wide">Explorer</span>
        <div class="flex items-center gap-1">
          <button
            type="button"
            data-action="click->app#newNote"
            class="p-1 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
            title="New Note (Ctrl+N)"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
          </button>
          <button
            type="button"
            data-action="click->app#newFolder"
            class="p-1 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
            title="New Folder"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
            </svg>
          </button>
          <div class="w-px h-4 bg-[var(--theme-border)] mx-0.5"></div>
          <button
            type="button"
            data-action="click->app#openFileFinder"
            class="p-1 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
            title="Find File (Ctrl+P)"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </button>
          <button
            type="button"
            data-action="click->app#openContentSearch"
            class="p-1 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
            title="Search in Files (Ctrl+Shift+F)"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16l2.879-2.879m0 0a3 3 0 104.243-4.242 3 3 0 00-4.243 4.242zM21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </button>
        </div>
      </div>

      <!-- File Tree -->
      <div
        class="flex-1 overflow-y-auto p-2"
        data-app-target="fileTree"
        data-action="dragover->app#onDragOverRoot dragenter->app#onDragEnterRoot dragleave->app#onDragLeaveRoot drop->app#onDropToRoot"
      >
        <!-- Tree will be rendered by JavaScript -->
      </div>
    </aside>

    <!-- Editor Panel -->
    <main class="flex-1 flex flex-col min-w-0" data-app-target="editorPanel">
      <!-- Editor Header -->
      <div class="flex-none h-10 border-b border-[var(--theme-border)] flex items-center px-4 bg-[var(--theme-bg-primary)]">
        <span class="text-sm text-[var(--theme-text-muted)] truncate" data-app-target="currentPath">
          Select or create a note
        </span>
        <span class="ml-2 text-xs text-[var(--theme-text-faint)] hidden" data-app-target="saveStatus"></span>
      </div>

      <!-- Editor Toolbar (visible when editing) -->
      <div class="flex-none h-9 border-b border-[var(--theme-border)] hidden items-center px-2 gap-1 bg-[var(--theme-bg-secondary)]" data-app-target="editorToolbar">
        <button
          type="button"
          data-action="click->app#openHelp"
          class="px-2 py-1 text-xs rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)] flex items-center gap-1"
          title="Markdown Help (F1)"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Help
        </button>
        <div class="h-5 w-px bg-[var(--theme-border)] mx-1"></div>
        <button
          type="button"
          data-action="click->app#openTableEditor"
          class="px-2 py-1 text-xs rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)] flex items-center gap-1"
          title="Insert/Edit Table"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18M10 3v18M14 3v18M3 6a3 3 0 013-3h12a3 3 0 013 3v12a3 3 0 01-3 3H6a3 3 0 01-3-3V6z" />
          </svg>
          Table
        </button>
        <button
          type="button"
          data-action="click->app#openImagePicker"
          class="px-2 py-1 text-xs rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)] flex items-center gap-1 hidden"
          title="Insert Image"
          data-app-target="imageBtn"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          Image
        </button>
        <button
          type="button"
          data-action="click->app#openVideoDialog"
          class="px-2 py-1 text-xs rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)] flex items-center gap-1"
          title="Insert Video"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Video
        </button>
        <button
          type="button"
          data-action="click->app#openCodeEditor"
          class="px-2 py-1 text-xs rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)] flex items-center gap-1"
          title="Insert/Edit Code Block"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
          Code
        </button>
        <div class="h-5 w-px bg-[var(--theme-border)] mx-1"></div>
        <button
          type="button"
          data-action="click->app#openCustomize"
          class="px-2 py-1 text-xs rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)] flex items-center gap-1"
          title="Editor Settings"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          Font
        </button>
        <div class="h-5 w-px bg-[var(--theme-border)] mx-1"></div>
        <span class="text-xs text-[var(--theme-text-faint)] hidden" data-app-target="tableHint">
          Cursor in table - click to edit
        </span>
      </div>

      <!-- Editor Container -->
      <div class="flex-1 overflow-hidden" data-app-target="editorContainer">
        <div class="h-full flex items-center justify-center text-[var(--theme-text-faint)]" data-app-target="editorPlaceholder">
          <div class="text-center">
            <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <p class="text-sm">Select a note to edit</p>
            <p class="text-xs mt-1">or press Ctrl+N to create a new one</p>
          </div>
        </div>
        <div class="h-full hidden" data-app-target="editor">
          <!-- Centered editor wrapper for typewriter mode -->
          <div class="h-full flex justify-center" data-app-target="editorWrapper">
            <textarea
              data-app-target="textarea"
              data-action="input->app#onTextareaInput"
              class="editor-textarea w-full h-full p-4 resize-none bg-[var(--theme-bg-primary)] text-[var(--theme-text-primary)] font-mono text-sm leading-relaxed focus:outline-none"
              placeholder="Start writing..."
              spellcheck="false"
            ></textarea>
          </div>
        </div>
      </div>
    </main>

    <!-- Preview Panel -->
    <aside class="flex-none w-[40%] border-l border-[var(--theme-border)] flex-col bg-[var(--theme-bg-primary)] hidden" data-app-target="previewPanel">
      <!-- Preview Header -->
      <div class="flex-none h-10 border-b border-[var(--theme-border)] flex items-center justify-between px-4">
        <span class="text-xs font-medium text-[var(--theme-text-muted)] uppercase tracking-wide">Preview</span>
        <div class="flex items-center gap-1">
          <button
            type="button"
            data-action="click->app#zoomPreviewOut"
            class="p-1 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
            title="Zoom Out"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7" />
            </svg>
          </button>
          <span class="text-xs text-[var(--theme-text-muted)] min-w-[3rem] text-center" data-app-target="previewZoomLevel">100%</span>
          <button
            type="button"
            data-action="click->app#zoomPreviewIn"
            class="p-1 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
            title="Zoom In"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Preview Content -->
      <div class="flex-1 overflow-y-auto p-6 prose prose-zinc dark:prose-invert prose-sm max-w-none" data-app-target="previewContent">
      </div>
    </aside>
  </div>

  <!-- Context Menu -->
  <div
    class="fixed hidden bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg shadow-lg py-1 min-w-[160px] z-50 text-zinc-900 dark:text-zinc-100"
    data-app-target="contextMenu"
  >
    <button
      type="button"
      data-action="click->app#newNoteInFolder"
      data-app-target="newNoteBtn"
      class="hidden w-full px-3 py-1.5 text-left text-sm hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      New Note
    </button>
    <button
      type="button"
      data-action="click->app#renameItem"
      class="w-full px-3 py-1.5 text-left text-sm hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
      </svg>
      Rename
    </button>
    <button
      type="button"
      data-action="click->app#deleteItem"
      class="w-full px-3 py-1.5 text-left text-sm hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2 text-red-600 dark:text-red-400"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
      Delete
    </button>
  </div>

<!-- Rename Dialog -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700"
  data-app-target="renameDialog"
>
  <form method="dialog" class="p-4 w-80 text-zinc-900 dark:text-zinc-100" data-action="submit->app#submitRename">
    <h3 class="text-sm font-semibold mb-3">Rename</h3>
    <input
      type="text"
      data-app-target="renameInput"
      class="w-full px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
      placeholder="New name"
    >
    <div class="flex justify-end gap-2 mt-4">
      <button
        type="button"
        data-action="click->app#closeRenameDialog"
        class="px-3 py-1.5 text-sm rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="px-3 py-1.5 text-sm rounded-md bg-blue-500 text-white hover:bg-blue-600"
      >
        Rename
      </button>
    </div>
  </form>
</dialog>

<!-- New Item Dialog -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700"
  data-app-target="newItemDialog"
>
  <form method="dialog" class="p-4 w-80 text-zinc-900 dark:text-zinc-100" data-action="submit->app#submitNewItem">
    <h3 class="text-sm font-semibold mb-3" data-app-target="newItemTitle">New Note</h3>
    <input
      type="text"
      data-app-target="newItemInput"
      class="w-full px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
      placeholder="Name"
    >
    <div class="flex justify-end gap-2 mt-4">
      <button
        type="button"
        data-action="click->app#closeNewItemDialog"
        class="px-3 py-1.5 text-sm rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300"
      >
        Cancel
      </button>
      <button
        type="submit"
        class="px-3 py-1.5 text-sm rounded-md bg-blue-500 text-white hover:bg-blue-600"
      >
        Create
      </button>
    </div>
  </form>
</dialog>

<!-- Table Editor Dialog -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 max-w-3xl"
  data-app-target="tableDialog"
>
  <div class="p-4 text-zinc-900 dark:text-zinc-100">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-sm font-semibold">Table Editor</h3>
      <div class="flex items-center gap-1">
        <button
          type="button"
          data-action="click->app#addTableColumn"
          class="p-1.5 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-600 dark:text-zinc-400"
          title="Add Column"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
        </button>
        <button
          type="button"
          data-action="click->app#removeTableColumn"
          class="p-1.5 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-600 dark:text-zinc-400"
          title="Remove Column"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
          </svg>
        </button>
        <div class="h-4 w-px bg-zinc-300 dark:bg-zinc-600 mx-1"></div>
        <button
          type="button"
          data-action="click->app#addTableRow"
          class="p-1.5 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-600 dark:text-zinc-400"
          title="Add Row"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
        </button>
        <button
          type="button"
          data-action="click->app#removeTableRow"
          class="p-1.5 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-600 dark:text-zinc-400"
          title="Remove Row"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Table Cell Context Menu -->
    <div
      class="fixed hidden bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg shadow-lg py-1 min-w-[140px] z-[60] text-zinc-900 dark:text-zinc-100"
      data-app-target="tableCellMenu"
    >
      <div class="px-2 py-1 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase">Column</div>
      <button
        type="button"
        data-action="click->app#moveColumnLeft"
        data-app-target="moveColLeftBtn"
        class="w-full px-3 py-1.5 text-left text-sm hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Move Left
      </button>
      <button
        type="button"
        data-action="click->app#moveColumnRight"
        data-app-target="moveColRightBtn"
        class="w-full px-3 py-1.5 text-left text-sm hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        Move Right
      </button>
      <button
        type="button"
        data-action="click->app#deleteColumnAt"
        data-app-target="deleteColBtn"
        class="w-full px-3 py-1.5 text-left text-sm hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2 text-red-600 dark:text-red-400"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Delete Column
      </button>
      <div class="border-t border-zinc-200 dark:border-zinc-700 my-1"></div>
      <div class="px-2 py-1 text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase">Row</div>
      <button
        type="button"
        data-action="click->app#moveRowUp"
        data-app-target="moveRowUpBtn"
        class="w-full px-3 py-1.5 text-left text-sm hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
        Move Up
      </button>
      <button
        type="button"
        data-action="click->app#moveRowDown"
        data-app-target="moveRowDownBtn"
        class="w-full px-3 py-1.5 text-left text-sm hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
        Move Down
      </button>
      <button
        type="button"
        data-action="click->app#deleteRowAt"
        data-app-target="deleteRowBtn"
        class="w-full px-3 py-1.5 text-left text-sm hover:bg-zinc-100 dark:hover:bg-zinc-700 flex items-center gap-2 text-red-600 dark:text-red-400"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Delete Row
      </button>
    </div>

    <!-- Table Grid -->
    <div class="overflow-auto max-h-80 border border-zinc-300 dark:border-zinc-600 rounded-md" data-app-target="tableGrid">
      <!-- Grid will be rendered by JavaScript -->
    </div>

    <div class="flex items-center justify-between mt-4">
      <span class="text-xs text-zinc-500 dark:text-zinc-400" data-app-target="tableSize">3 x 3</span>
      <div class="flex gap-2">
        <button
          type="button"
          data-action="click->app#closeTableDialog"
          class="px-3 py-1.5 text-sm rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300"
        >
          Cancel
        </button>
        <button
          type="button"
          data-action="click->app#insertTable"
          class="px-3 py-1.5 text-sm rounded-md bg-blue-500 text-white hover:bg-blue-600"
        >
          Insert Table
        </button>
      </div>
    </div>
  </div>
</dialog>

<!-- Image Picker Dialog -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 w-[700px] max-w-[90vw]"
  data-app-target="imageDialog"
>
  <div class="text-zinc-900 dark:text-zinc-100">
    <!-- Header -->
    <div class="flex items-center justify-between px-4 pt-4">
      <h3 class="text-sm font-semibold">Insert Image</h3>
      <button
        type="button"
        data-action="click->app#closeImageDialog"
        class="p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-500"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Tabs -->
    <div class="flex border-b border-zinc-200 dark:border-zinc-700 px-4 mt-2">
      <button
        type="button"
        data-action="click->app#switchImageTab"
        data-tab="local"
        data-app-target="imageTabLocal"
        class="px-4 py-2 text-sm font-medium border-b-2 border-blue-500 text-blue-600 dark:text-blue-400"
      >
        Local
      </button>
      <button
        type="button"
        data-action="click->app#switchImageTab"
        data-tab="web"
        data-app-target="imageTabWeb"
        class="px-4 py-2 text-sm font-medium border-b-2 border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"
      >
        Web Search
      </button>
      <button
        type="button"
        data-action="click->app#switchImageTab"
        data-tab="google"
        data-app-target="imageTabGoogle"
        class="px-4 py-2 text-sm font-medium border-b-2 border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300 hidden"
      >
        Google
      </button>
      <button
        type="button"
        data-action="click->app#switchImageTab"
        data-tab="pinterest"
        data-app-target="imageTabPinterest"
        class="px-4 py-2 text-sm font-medium border-b-2 border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"
      >
        Pinterest
      </button>
    </div>

    <!-- Tab Content: Local Images -->
    <div class="p-4" data-app-target="imageLocalPanel">
      <!-- Search -->
      <div class="mb-3">
        <input
          type="text"
          data-app-target="imageSearch"
          data-action="input->app#onImageSearch"
          class="w-full px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="Search images by filename..."
        >
      </div>

      <!-- Image Grid -->
      <div class="grid grid-cols-5 gap-2 mb-4 min-h-[200px] max-h-[300px] overflow-y-auto" data-app-target="imageGrid">
        <!-- Images will be rendered by JavaScript -->
      </div>
    </div>

    <!-- Tab Content: Web Search (Bing/DuckDuckGo) -->
    <div class="p-4 hidden" data-app-target="imageWebPanel">
      <!-- Search -->
      <div class="mb-3">
        <div class="flex gap-2">
          <input
            type="text"
            data-app-target="webImageSearch"
            data-action="keydown->app#onWebImageSearchKeydown"
            class="flex-1 px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Search web images..."
          >
          <button
            type="button"
            data-action="click->app#searchWebImages"
            data-app-target="webSearchBtn"
            class="px-4 py-2 text-sm rounded-md bg-blue-500 text-white hover:bg-blue-600 flex items-center gap-1"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Search
          </button>
        </div>
      </div>

      <!-- Status -->
      <div class="mb-2 text-xs text-zinc-500 dark:text-zinc-400" data-app-target="webImageStatus">
        Enter keywords and click Search or press Enter
      </div>

      <!-- Image Grid -->
      <div class="grid grid-cols-4 gap-2 mb-4 min-h-[200px] max-h-[350px] overflow-y-auto" data-app-target="webImageGrid">
        <!-- Images will be rendered by JavaScript -->
      </div>
    </div>

    <!-- Tab Content: Google Images (requires API key) -->
    <div class="p-4 hidden" data-app-target="imageGooglePanel">
      <!-- Search -->
      <div class="mb-3">
        <div class="flex gap-2">
          <input
            type="text"
            data-app-target="googleImageSearch"
            data-action="keydown->app#onGoogleImageSearchKeydown"
            class="flex-1 px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Search Google Images..."
          >
          <button
            type="button"
            data-action="click->app#searchGoogleImages"
            data-app-target="googleSearchBtn"
            class="px-4 py-2 text-sm rounded-md bg-blue-500 text-white hover:bg-blue-600 flex items-center gap-1"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Search
          </button>
        </div>
      </div>

      <!-- Status -->
      <div class="mb-2 text-xs text-zinc-500 dark:text-zinc-400" data-app-target="googleImageStatus">
        Enter keywords and click Search or press Enter
      </div>

      <!-- Image Grid with infinite scroll -->
      <div
        class="grid grid-cols-4 gap-2 mb-4 min-h-[200px] max-h-[350px] overflow-y-auto"
        data-app-target="googleImageGrid"
        data-action="scroll->app#onGoogleImageScroll"
      >
        <!-- Images will be rendered by JavaScript -->
      </div>
    </div>

    <!-- Tab Content: Pinterest -->
    <div class="p-4 hidden" data-app-target="imagePinterestPanel">
      <!-- Search -->
      <div class="mb-3">
        <div class="flex gap-2">
          <input
            type="text"
            data-app-target="pinterestImageSearch"
            data-action="keydown->app#onPinterestImageSearchKeydown"
            class="flex-1 px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Search Pinterest..."
          >
          <button
            type="button"
            data-action="click->app#searchPinterestImages"
            data-app-target="pinterestSearchBtn"
            class="px-4 py-2 text-sm rounded-md bg-red-500 text-white hover:bg-red-600 flex items-center gap-1"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Search
          </button>
        </div>
      </div>

      <!-- Status -->
      <div class="mb-2 text-xs text-zinc-500 dark:text-zinc-400" data-app-target="pinterestImageStatus">
        Enter keywords and click Search or press Enter
      </div>

      <!-- Image Grid -->
      <div class="grid grid-cols-4 gap-2 mb-4 min-h-[200px] max-h-[350px] overflow-y-auto" data-app-target="pinterestImageGrid">
        <!-- Images will be rendered by JavaScript -->
      </div>
    </div>

    <!-- Selected Image Options (shared across all tabs) -->
    <div class="border-t border-zinc-200 dark:border-zinc-700 px-4 pt-3 hidden" data-app-target="imageOptions">
      <div class="flex items-center gap-2 mb-3 text-sm">
        <span class="text-zinc-500">Selected:</span>
        <span class="font-medium truncate max-w-md" data-app-target="selectedImageName"></span>
      </div>

      <!-- Options -->
      <div class="space-y-3">
        <!-- Alt Text -->
        <div>
          <label class="block text-xs text-zinc-500 dark:text-zinc-400 mb-1">Alt Text (optional)</label>
          <input
            type="text"
            data-app-target="imageAlt"
            class="w-full px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Describe the image..."
          >
        </div>

        <!-- Link URL -->
        <div>
          <label class="block text-xs text-zinc-500 dark:text-zinc-400 mb-1">Link URL (optional, makes image clickable)</label>
          <input
            type="text"
            data-app-target="imageLink"
            class="w-full px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="https://..."
          >
        </div>

        <!-- S3 Upload Option (for local images) -->
        <div class="hidden" data-app-target="s3Option">
          <label class="flex items-center gap-2 text-sm cursor-pointer">
            <input
              type="checkbox"
              data-app-target="uploadToS3"
              class="rounded border-zinc-300 dark:border-zinc-600 text-blue-500 focus:ring-blue-500"
            >
            <span>Upload to AWS S3 first</span>
          </label>
          <p class="text-xs text-zinc-500 dark:text-zinc-400 mt-1 ml-6">
            Image will be uploaded to S3 and the URL will be used instead of local path
          </p>
        </div>

        <!-- S3 Re-upload Option (for external images) -->
        <div class="hidden" data-app-target="s3ExternalOption">
          <label class="flex items-center gap-2 text-sm cursor-pointer">
            <input
              type="checkbox"
              data-app-target="reuploadToS3"
              class="rounded border-zinc-300 dark:border-zinc-600 text-blue-500 focus:ring-blue-500"
            >
            <span>Download and re-upload to AWS S3</span>
          </label>
          <p class="text-xs text-zinc-500 dark:text-zinc-400 mt-1 ml-6">
            Image will be downloaded and uploaded to your S3, using your URL instead of the original
          </p>
        </div>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div class="hidden items-center justify-center py-8 px-4" data-app-target="imageLoading">
      <svg class="animate-spin w-6 h-6 text-blue-500" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <span class="ml-2 text-sm text-zinc-500" data-app-target="imageLoadingText">Uploading to S3...</span>
    </div>

    <!-- Footer -->
    <div class="flex justify-end gap-2 px-4 pb-4 pt-4 border-t border-zinc-200 dark:border-zinc-700">
      <button
        type="button"
        data-action="click->app#closeImageDialog"
        class="px-3 py-1.5 text-sm rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300"
      >
        Cancel
      </button>
      <button
        type="button"
        data-action="click->app#insertImage"
        data-app-target="insertImageBtn"
        class="px-3 py-1.5 text-sm rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
        disabled
      >
        Insert Image
      </button>
    </div>
  </div>
</dialog>

<!-- Help Dialog (Markdown Cheatsheet) -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 max-w-4xl w-full max-h-[85vh]"
  data-app-target="helpDialog"
>
  <div class="p-4 text-zinc-900 dark:text-zinc-100 overflow-y-auto">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold">Markdown Cheatsheet</h3>
      <div class="flex items-center gap-2">
        <span class="text-xs text-zinc-500 dark:text-zinc-400">Press F1 or Ctrl+H to toggle</span>
        <button
          type="button"
          data-action="click->app#closeHelp"
          class="p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-500"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-4">
      <!-- Column 1 -->
      <div class="space-y-3">
        <div class="bg-zinc-50 dark:bg-zinc-900 rounded-lg p-3">
          <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-2">Headings</h4>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <code class="font-mono text-zinc-600 dark:text-zinc-300"># Heading 1</code>
            <span class="text-xl font-bold">Heading 1</span>
            <code class="font-mono text-zinc-600 dark:text-zinc-300">## Heading 2</code>
            <span class="text-lg font-bold">Heading 2</span>
            <code class="font-mono text-zinc-600 dark:text-zinc-300">### Heading 3</code>
            <span class="text-base font-bold">Heading 3</span>
          </div>
        </div>

        <div class="bg-zinc-50 dark:bg-zinc-900 rounded-lg p-3">
          <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-2">Emphasis</h4>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <code class="font-mono text-zinc-600 dark:text-zinc-300">**bold**</code>
            <span class="font-bold">bold</span>
            <code class="font-mono text-zinc-600 dark:text-zinc-300">*italic*</code>
            <span class="italic">italic</span>
            <code class="font-mono text-zinc-600 dark:text-zinc-300">~~strikethrough~~</code>
            <span class="line-through">strikethrough</span>
            <code class="font-mono text-zinc-600 dark:text-zinc-300">`inline code`</code>
            <code class="bg-zinc-200 dark:bg-zinc-700 px-1 rounded text-sm">inline code</code>
          </div>
        </div>

        <div class="bg-zinc-50 dark:bg-zinc-900 rounded-lg p-3">
          <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-2">Lists</h4>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <div class="font-mono text-zinc-600 dark:text-zinc-300">
              <div>- Item 1</div>
              <div>- Item 2</div>
            </div>
            <div>
              <div>&bull; Item 1</div>
              <div>&bull; Item 2</div>
            </div>
            <div class="font-mono text-zinc-600 dark:text-zinc-300">
              <div>1. First</div>
              <div>2. Second</div>
            </div>
            <div>
              <div>1. First</div>
              <div>2. Second</div>
            </div>
          </div>
        </div>

        <div class="bg-zinc-50 dark:bg-zinc-900 rounded-lg p-3">
          <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-2">Task List</h4>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <div class="font-mono text-zinc-600 dark:text-zinc-300">
              <div>- [x] Done</div>
              <div>- [ ] Todo</div>
            </div>
            <div>
              <div><input type="checkbox" checked disabled class="mr-1">Done</div>
              <div><input type="checkbox" disabled class="mr-1">Todo</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Column 2 -->
      <div class="space-y-3">
        <div class="bg-zinc-50 dark:bg-zinc-900 rounded-lg p-3">
          <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-2">Links & Images</h4>
          <div class="space-y-2 text-sm">
            <div class="grid grid-cols-2 gap-2">
              <code class="font-mono text-zinc-600 dark:text-zinc-300">[text](url)</code>
              <a href="#" class="text-blue-500 underline">text</a>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <code class="font-mono text-zinc-600 dark:text-zinc-300">![alt](image.jpg)</code>
              <span class="text-zinc-500">[image]</span>
            </div>
          </div>
        </div>

        <div class="bg-zinc-50 dark:bg-zinc-900 rounded-lg p-3">
          <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-2">Blockquote</h4>
          <div class="grid grid-cols-2 gap-2 text-sm">
            <code class="font-mono text-zinc-600 dark:text-zinc-300">> Quote text</code>
            <blockquote class="border-l-2 border-zinc-400 pl-2 italic text-zinc-600 dark:text-zinc-400">Quote text</blockquote>
          </div>
        </div>

        <div class="bg-zinc-50 dark:bg-zinc-900 rounded-lg p-3">
          <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-2">Code Block</h4>
          <div class="text-sm space-y-1">
            <div class="font-mono text-zinc-600 dark:text-zinc-300">
              <div>```javascript</div>
              <div>const x = 1;</div>
              <div>```</div>
            </div>
            <pre class="bg-zinc-200 dark:bg-zinc-700 p-2 rounded text-xs"><code>const x = 1;</code></pre>
          </div>
        </div>

        <div class="bg-zinc-50 dark:bg-zinc-900 rounded-lg p-3">
          <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-2">Table</h4>
          <div class="text-sm space-y-1">
            <div class="font-mono text-zinc-600 dark:text-zinc-300 text-xs">
              <div>| Col 1 | Col 2 |</div>
              <div>| ----- | ----- |</div>
              <div>| A     | B     |</div>
            </div>
            <table class="text-xs border-collapse">
              <tr><th class="border border-zinc-300 dark:border-zinc-600 px-2">Col 1</th><th class="border border-zinc-300 dark:border-zinc-600 px-2">Col 2</th></tr>
              <tr><td class="border border-zinc-300 dark:border-zinc-600 px-2">A</td><td class="border border-zinc-300 dark:border-zinc-600 px-2">B</td></tr>
            </table>
          </div>
        </div>

        <div class="bg-zinc-50 dark:bg-zinc-900 rounded-lg p-3">
          <h4 class="text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase mb-2">Horizontal Rule</h4>
          <div class="grid grid-cols-2 gap-2 text-sm items-center">
            <code class="font-mono text-zinc-600 dark:text-zinc-300">---</code>
            <hr class="border-zinc-400">
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4 pt-3 border-t border-zinc-200 dark:border-zinc-700 text-xs text-zinc-500 dark:text-zinc-400 text-center">
      <span class="font-semibold">Keyboard Shortcuts:</span>
      Ctrl+S save &bull; Ctrl+N new note &bull; Ctrl+P find file &bull; Ctrl+Shift+F search content &bull; Ctrl+E explorer &bull; Ctrl+B typewriter &bull; Ctrl+Shift+P preview &bull; F1 help
    </div>
  </div>
</dialog>

<!-- File Finder Dialog (Ctrl+P) -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 w-[600px] max-h-[70vh]"
  data-app-target="fileFinderDialog"
>
  <div class="flex flex-col max-h-[70vh]">
    <!-- Search Input -->
    <div class="p-3 border-b border-[var(--theme-border)]">
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5 text-[var(--theme-text-muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <input
          type="text"
          data-app-target="fileFinderInput"
          data-action="input->app#onFileFinderInput keydown->app#onFileFinderKeydown"
          class="flex-1 bg-transparent border-0 text-[var(--theme-text-primary)] placeholder-[var(--theme-text-muted)] focus:outline-none text-sm"
          placeholder="Type to search files..."
          autocomplete="off"
          spellcheck="false"
        >
        <span class="text-xs text-[var(--theme-text-faint)]">esc to close</span>
      </div>
    </div>

    <!-- Results List -->
    <div class="flex-1 overflow-y-auto min-h-[200px] max-h-[300px]" data-app-target="fileFinderResults">
      <!-- Results rendered by JavaScript -->
    </div>

    <!-- Preview Panel -->
    <div class="border-t border-[var(--theme-border)] p-3 bg-[var(--theme-bg-tertiary)] max-h-[200px] overflow-y-auto" data-app-target="fileFinderPreview">
      <!-- Preview rendered by JavaScript -->
    </div>
  </div>
</dialog>

<!-- Content Search Dialog (Ctrl+Shift+F) -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 w-[700px] max-h-[80vh]"
  data-app-target="contentSearchDialog"
>
  <div class="flex flex-col max-h-[80vh]">
    <!-- Search Input -->
    <div class="p-3 border-b border-[var(--theme-border)]">
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5 text-[var(--theme-text-muted)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16l2.879-2.879m0 0a3 3 0 104.243-4.242 3 3 0 00-4.243 4.242zM21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <input
          type="text"
          data-app-target="contentSearchInput"
          data-action="input->app#onContentSearchInput keydown->app#onContentSearchKeydown"
          class="flex-1 bg-transparent border-0 text-[var(--theme-text-primary)] placeholder-[var(--theme-text-muted)] focus:outline-none text-sm font-mono"
          placeholder="Search in files (supports regex)..."
          autocomplete="off"
          spellcheck="false"
        >
        <span class="text-xs text-[var(--theme-text-faint)]">esc to close</span>
      </div>
      <div class="mt-1 text-xs text-[var(--theme-text-muted)]" data-app-target="contentSearchStatus">
        Type to search in file contents (supports regex)
      </div>
      <div class="mt-2 text-xs text-[var(--theme-text-faint)] flex flex-wrap gap-x-4 gap-y-1">
        <span><code class="bg-[var(--theme-bg-tertiary)] px-1 rounded">hello</code> literal text</span>
        <span><code class="bg-[var(--theme-bg-tertiary)] px-1 rounded">hello|world</code> OR</span>
        <span><code class="bg-[var(--theme-bg-tertiary)] px-1 rounded">hel+o</code> one or more</span>
        <span><code class="bg-[var(--theme-bg-tertiary)] px-1 rounded">hel.*o</code> any chars</span>
        <span><code class="bg-[var(--theme-bg-tertiary)] px-1 rounded">^hello</code> start of line</span>
        <span><code class="bg-[var(--theme-bg-tertiary)] px-1 rounded">hello$</code> end of line</span>
        <span><code class="bg-[var(--theme-bg-tertiary)] px-1 rounded">\d+</code> digits</span>
        <span><code class="bg-[var(--theme-bg-tertiary)] px-1 rounded">\bword\b</code> whole word</span>
      </div>
    </div>

    <!-- Results List -->
    <div
      class="flex-1 overflow-y-auto min-h-[200px] max-h-[60vh]"
      data-app-target="contentSearchResults"
      data-action="mousemove->app#onContentSearchMouseMove"
    >
      <!-- Results rendered by JavaScript -->
    </div>
  </div>
</dialog>

<!-- Editor Customization Dialog -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 w-[400px]"
  data-app-target="customizeDialog"
>
  <div class="p-4">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-sm font-semibold">Editor Settings</h3>
      <button
        type="button"
        data-action="click->app#closeCustomizeDialog"
        class="p-1 rounded hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-muted)]"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Font Family -->
    <div class="mb-4">
      <label class="block text-xs text-[var(--theme-text-muted)] mb-1.5">Font Family</label>
      <select
        data-app-target="fontSelect"
        data-action="change->app#onFontChange"
        class="w-full px-3 py-2 text-sm border border-[var(--theme-border)] rounded-md bg-[var(--theme-bg-primary)] text-[var(--theme-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent)]"
      >
        <option value="cascadia-code" style="font-family: 'Cascadia Code', monospace">Cascadia Code</option>
        <option value="consolas" style="font-family: Consolas, monospace">Consolas</option>
        <option value="dejavu-mono" style="font-family: 'DejaVu Mono', monospace">DejaVu Sans Mono</option>
        <option value="fira-code" style="font-family: 'Fira Code', monospace">Fira Code</option>
        <option value="hack" style="font-family: Hack, monospace">Hack</option>
        <option value="jetbrains-mono" style="font-family: 'JetBrains Mono', monospace">JetBrains Mono</option>
        <option value="roboto-mono" style="font-family: 'Roboto Mono', monospace">Roboto Mono</option>
        <option value="source-code-pro" style="font-family: 'Source Code Pro', monospace">Source Code Pro</option>
        <option value="ubuntu-mono" style="font-family: 'Ubuntu Mono', monospace">Ubuntu Mono</option>
      </select>
    </div>

    <!-- Font Size -->
    <div class="mb-4">
      <label class="block text-xs text-[var(--theme-text-muted)] mb-1.5">Font Size</label>
      <select
        data-app-target="fontSizeSelect"
        data-action="change->app#onFontSizeChange"
        class="w-full px-3 py-2 text-sm border border-[var(--theme-border)] rounded-md bg-[var(--theme-bg-primary)] text-[var(--theme-text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent)]"
      >
        <option value="12">12px</option>
        <option value="13">13px</option>
        <option value="14" selected>14px</option>
        <option value="15">15px</option>
        <option value="16">16px</option>
        <option value="18">18px</option>
        <option value="20">20px</option>
        <option value="22">22px</option>
        <option value="24">24px</option>
      </select>
    </div>

    <!-- Preview -->
    <div class="mb-4">
      <label class="block text-xs text-[var(--theme-text-muted)] mb-1.5">Preview</label>
      <div
        data-app-target="fontPreview"
        class="p-3 border border-[var(--theme-border)] rounded-md bg-[var(--theme-bg-primary)] text-[var(--theme-text-primary)] h-24 overflow-hidden"
        style="font-family: 'Cascadia Code', monospace; font-size: 14px; line-height: 1.6;"
      >
        <div>// The quick brown fox</div>
        <div>function hello() {</div>
        <div>&nbsp;&nbsp;return "Hello, World!";</div>
        <div>}</div>
      </div>
    </div>

    <!-- Footer -->
    <div class="flex justify-end gap-2">
      <button
        type="button"
        data-action="click->app#closeCustomizeDialog"
        class="px-3 py-1.5 text-sm rounded-md hover:bg-[var(--theme-bg-hover)] text-[var(--theme-text-secondary)]"
      >
        Cancel
      </button>
      <button
        type="button"
        data-action="click->app#applyCustomization"
        class="px-3 py-1.5 text-sm rounded-md bg-[var(--theme-accent)] text-[var(--theme-accent-text)] hover:opacity-90"
      >
        Apply
      </button>
    </div>
  </div>
</dialog>

<!-- Code Snippet Dialog -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 w-[500px]"
  data-app-target="codeDialog"
>
  <div class="p-4 text-zinc-900 dark:text-zinc-100">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-sm font-semibold">Code Block</h3>
      <button
        type="button"
        data-action="click->app#closeCodeDialog"
        class="p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-500"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Language Input with Autocomplete -->
    <div class="mb-4 relative">
      <label class="block text-xs text-zinc-500 dark:text-zinc-400 mb-1">Language (Tab to autocomplete)</label>
      <input
        type="text"
        data-app-target="codeLanguage"
        data-action="input->app#onCodeLanguageInput keydown->app#onCodeLanguageKeydown"
        class="w-full px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono"
        placeholder="javascript, python, ruby..."
        autocomplete="off"
        spellcheck="false"
      >
      <!-- Suggestions dropdown -->
      <div
        class="hidden absolute z-10 w-full mt-1 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-md shadow-lg max-h-48 overflow-y-auto"
        data-app-target="codeSuggestions"
      >
        <!-- Suggestions will be populated by JavaScript -->
      </div>
    </div>

    <!-- Code Content -->
    <div class="mb-4">
      <label class="block text-xs text-zinc-500 dark:text-zinc-400 mb-1">Code (optional) &mdash; Ctrl+Enter to insert</label>
      <textarea
        data-app-target="codeContent"
        data-action="keydown->app#onCodeContentKeydown"
        class="w-full h-48 px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono resize-none"
        placeholder="Paste or type your code here..."
        spellcheck="false"
      ></textarea>
    </div>

    <!-- Footer -->
    <div class="flex justify-end gap-2">
      <button
        type="button"
        data-action="click->app#closeCodeDialog"
        class="px-3 py-1.5 text-sm rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300"
      >
        Cancel
      </button>
      <button
        type="button"
        data-action="click->app#insertCode"
        class="px-3 py-1.5 text-sm rounded-md bg-blue-500 text-white hover:bg-blue-600"
      >
        Insert Code
      </button>
    </div>
  </div>
</dialog>

<!-- Video Dialog -->
<dialog
  class="p-0 rounded-lg shadow-xl backdrop:bg-black/50 bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 w-[550px]"
  data-app-target="videoDialog"
>
  <div class="text-zinc-900 dark:text-zinc-100">
    <!-- Header with close button -->
    <div class="flex items-center justify-between px-4 pt-4">
      <h3 class="text-sm font-semibold">Insert Video</h3>
      <button
        type="button"
        data-action="click->app#closeVideoDialog"
        class="p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 text-zinc-500"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Tabs -->
    <div class="flex border-b border-zinc-200 dark:border-zinc-700 px-4 mt-2">
      <button
        type="button"
        data-action="click->app#switchVideoTab"
        data-tab="url"
        data-app-target="videoTabUrl"
        class="px-4 py-2 text-sm font-medium border-b-2 border-blue-500 text-blue-600 dark:text-blue-400"
      >
        URL / File
      </button>
      <button
        type="button"
        data-action="click->app#switchVideoTab"
        data-tab="search"
        data-app-target="videoTabSearch"
        class="px-4 py-2 text-sm font-medium border-b-2 border-transparent text-zinc-500 hover:text-zinc-700 dark:hover:text-zinc-300"
      >
        YouTube Search
      </button>
    </div>

    <!-- Tab Content: URL -->
    <div class="p-4" data-app-target="videoUrlPanel">
      <div class="mb-4">
        <label class="block text-xs text-zinc-500 dark:text-zinc-400 mb-1">Video URL or Path</label>
        <input
          type="text"
          data-app-target="videoUrl"
          data-action="input->app#onVideoUrlInput keydown->app#onVideoUrlKeydown"
          class="w-full px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
          placeholder="YouTube URL or video file path..."
          autocomplete="off"
          spellcheck="false"
        >
        <div class="mt-2 text-xs text-zinc-500 dark:text-zinc-400 space-y-1">
          <p><strong>YouTube:</strong> https://youtube.com/watch?v=... or https://youtu.be/...</p>
          <p><strong>Video file:</strong> /path/to/video.mp4, .webm, .mkv, .mov, .avi</p>
        </div>
      </div>

      <div class="mb-4 p-3 bg-zinc-100 dark:bg-zinc-900 rounded-md text-sm" data-app-target="videoPreview">
        <span class="text-zinc-500 dark:text-zinc-400">Enter a URL to see preview</span>
      </div>

      <div class="flex justify-end gap-2">
        <button
          type="button"
          data-action="click->app#closeVideoDialog"
          class="px-3 py-1.5 text-sm rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300"
        >
          Cancel
        </button>
        <button
          type="button"
          data-action="click->app#insertVideo"
          data-app-target="insertVideoBtn"
          class="px-3 py-1.5 text-sm rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed"
          disabled
        >
          Insert Video
        </button>
      </div>
    </div>

    <!-- Tab Content: YouTube Search -->
    <div class="p-4 hidden" data-app-target="videoSearchPanel">
      <div class="mb-4">
        <label class="block text-xs text-zinc-500 dark:text-zinc-400 mb-1">Search YouTube</label>
        <div class="flex gap-2">
          <input
            type="text"
            data-app-target="youtubeSearchInput"
            data-action="keydown->app#onYoutubeSearchKeydown"
            class="flex-1 px-3 py-2 text-sm border border-zinc-300 dark:border-zinc-600 rounded-md bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Enter keywords..."
            autocomplete="off"
            spellcheck="false"
          >
          <button
            type="button"
            data-action="click->app#searchYoutube"
            data-app-target="youtubeSearchBtn"
            class="px-4 py-2 text-sm rounded-md bg-red-500 text-white hover:bg-red-600 flex items-center gap-1"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Search
          </button>
        </div>
      </div>

      <!-- Search Status -->
      <div class="mb-3 text-xs text-zinc-500 dark:text-zinc-400" data-app-target="youtubeSearchStatus">
        Enter keywords and click Search or press Enter
      </div>

      <!-- Search Results Grid -->
      <div class="grid grid-cols-2 gap-3 mb-4 min-h-[200px]" data-app-target="youtubeSearchResults">
        <!-- Results will be rendered by JavaScript -->
      </div>

      <div class="flex justify-end gap-2">
        <button
          type="button"
          data-action="click->app#closeVideoDialog"
          class="px-3 py-1.5 text-sm rounded-md hover:bg-zinc-100 dark:hover:bg-zinc-700 text-zinc-700 dark:text-zinc-300"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>
</dialog>
</div>
